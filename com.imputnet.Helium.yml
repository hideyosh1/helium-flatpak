app-id: com.imputnet.Helium
runtime: org.freedesktop.Platform
runtime-version: "25.08"
sdk: org.freedesktop.Sdk
command: helium

x-annotations:
  org.flatpak.metadata.name: "Helium"
  org.flatpak.metadata.summary: "Private, fast, and honest web browser"
  org.flatpak.metadata.description: |
    Helium is a lightweight, privacy-focused browser built upon Ungoogled Chromium.
    This Flatpak package uses the prebuilt binary provided by the Helium Linux project.
  org.flatpak.metadata.license: "GPL-3.0-or-later"
  org.flatpak.metadata.homepage: "https://github.com/imputnet/helium-linux"

finish-args:
  - --share=network
  - --share=ipc
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=cups # allow printing
  - --socket=pcsc
  - --device=dri
  - --socket=pulseaudio
  - --allow=bluetooth
  - --filesystem=xdg-download
  - --filesystem=xdg-pictures
  - --filesystem=xdg-videos
  - --filesystem=xdg-desktop
  - --filesystem=/tmp
  - --persist=.pki
  - --env=LD_LIBRARY_PATH=/app/lib/helium:$LD_LIBRARY_PATH
  - --env=CHROME_DEVEL_SANDBOX_DISABLED=1
  - --env=ICU_DATA_PATH=/app/lib/helium
  # Allow PWAs
  - --filesystem=home/.local/share/applications:create
  - --filesystem=home/.local/share/icons:create
  # GNOME-specific
  - --filesystem=xdg-run/dconf
  - --filesystem=~/.config/dconf:ro
  - --talk-name=ca.desrt.dconf
  - --env=DCONF_USER_CONFIG_DIR=.config/dconf
  - --env=GIO_EXTRA_MODULES=/app/lib/gio/modules
  - --env=GSETTINGS_BACKEND=dconf
  # KDE-specific
  - --filesystem=~/.config/kioslaverc

modules:
  - name: helium
    metadata: com.imputnet.Helium.xml
    buildsystem: simple
    build-commands:
      - tar -xvf helium-linux-x64.tar.gz
      - mkdir -p /app/lib/helium
      - mkdir -p /app/bin
      - cp -r helium-0.7.6.1-x86_64_linux/* /app/lib/helium
      - install -Dm755 helium-0.7.6.1-x86_64_linux/chrome /app/lib/helium/helium.real

      - echo '#!/bin/sh' > /app/bin/helium
      - echo 'exec /app/lib/helium/helium.real --no-sandbox --test-type "$@"' >> /app/bin/helium
      - chmod +x /app/bin/helium

      - install -Dm644 com.imputnet.Helium.desktop /app/share/applications/com.imputnet.Helium.desktop

      - mkdir -p icons/256x256 icons/128x128 icons/64x64
      - cp com.imputnet.Helium.png icons/256x256/
      - cp com.imputnet.Helium.png icons/128x128/
      - cp com.imputnet.Helium.png icons/64x64/

      - install -Dm644 icons/256x256/com.imputnet.Helium.png /app/share/icons/hicolor/256x256/apps/com.imputnet.Helium.png
      - install -Dm644 icons/128x128/com.imputnet.Helium.png /app/share/icons/hicolor/128x128/apps/com.imputnet.Helium.png
      - install -Dm644 icons/64x64/com.imputnet.Helium.png /app/share/icons/hicolor/64x64/apps/com.imputnet.Helium.png

    sources:
      - type: file
        url: https://github.com/imputnet/helium-linux/releases/download/0.7.6.1/helium-0.7.6.1-x86_64_linux.tar.xz
        sha256: 44bd0c32c62671ba19b7b6aad91ffaa272d7d5b4f19446e197007bc816fce28b
        dest-filename: helium-linux-x64.tar.gz
      - type: file
        path: com.imputnet.Helium.xml
      - type: file
        path: com.imputnet.Helium.desktop

      - type: file
        path: icons/128x128/com.imputnet.Helium.png
      - type: file
        path: icons/64x64/com.imputnet.Helium.png
      - type: file
        path: icons/256x256/com.imputnet.Helium.png
